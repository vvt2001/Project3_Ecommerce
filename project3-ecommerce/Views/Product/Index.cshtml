@model IPagedList<project3_ecommerce.Models.Product>
@using PagedList.Mvc;
@using PagedList;
@{
    ViewData["Title"] = "Các sản phẩm";
}
<style>
    .card-header {
        font-weight: bold;
        background-color: whitesmoke;
        padding: 0.5em 0.5em 0.5em 0.5em;
        margin: 0 0 0 0;
        border: solid 1px;
        border-color: lightgray;
        border-top-left-radius: 4px;
        border-top-right-radius: 4px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .card-body {
        border: solid 1px;
        border-color: lightgray;
        padding: 0.5em 1em 0.5em 1em;
        text-overflow: ellipsis;
        overflow: hidden;
    }

    .card-footer {
        background-color: whitesmoke;
        padding: 0.5em 0.5em 0.5em 1em;
        border: solid 1px;
        border-color: lightgray;
        vertical-align: middle;
        height: 70px;
        border-bottom-left-radius: 4px;
        border-bottom-right-radius: 4px;
        margin-bottom: 20px
    }

    .text-muted {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

</style>

<h2> Sản phẩm </h2>
<div class="container" style="margin:10px 0 10px 0">
    @foreach (var product in Model)
    {
        <div class="card col-md-3">
            <h3 class="card-header">@product.Name</h3>
            <div class="card-body" style="height: 150px;">
                @product.Description
            </div>
            <div class="card-footer">
                <div class="text-muted">@(product.Price.ToString("n0")) VND</div>
                <input type="button" value="Đặt hàng" class="btn btn-sm" style="float:right;background-color:black;color:white;margin:3px 3px 3px 3px" onclick="AddToCart(@product.ID)">
            </div>
        </div>
    }

    @Html.PagedListPager(Model, page => Url.Action("Index", "Product", new { page }),
        new PagedListRenderOptions
        {
            MaximumPageNumbersToDisplay = 5,
        })

</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
    function AddToCart(ID) {
        $.ajax({
            url: '@Url.Action("AddToCart")',
            type: 'POST',
            data: jQuery.param({ ID: ID }),
            success: function (data) {
                var jsonData = JSON.parse(data);
                if (jsonData.Message == "SUCCESS")
                    alert("Đã thêm sản phẩm vào giỏ hàng, xin kiểm tra.");
                else {
                    Response.Redirect("~/Account");
                }
            },
            error: function () {
                alert("Có lỗi trong việc thêm sản phẩm vào giỏ hàng.");
            },
        });
        return false;
    }
    </script>
}
